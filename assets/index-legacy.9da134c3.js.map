{"version":3,"file":"index-legacy.9da134c3.js","sources":["../../../../../../../@vite/dynamic-import-helper","../../src/system.js","../../src/index.js"],"sourcesContent":["export default (glob, path) => {\n    const v = glob[path];\n    if (v) {\n        return typeof v === 'function' ? v() : Promise.resolve(v);\n    }\n    return new Promise((_, reject) => {\n        (typeof queueMicrotask === 'function' ? queueMicrotask : setTimeout)(reject.bind(null, new Error('Unknown variable dynamic import: ' + path)));\n    });\n}","async function initGlobal() {\n    window.$ = {};\n    window.$.utils =\n    window.$u =\n    window.$utils = await import('./functions/index.js');\n    window.$.logic =\n    window.$logic = await import('./functions/logic.js');\n    window.$.normalize =\n    window.$norml =\n    window.$normalize = await import('./functions/normalize.js');\n    window.$.hash =\n    window.$hash = await import('./functions/hash.js');\n\n    window.$.event =\n    window.$event = await import('./event/index.js');\n    window.$on = $event.on;\n    window.$off = $event.off;\n    window.$emit = $event.emit;\n\n    window.$.moment =\n    window.$moment = (await import('moment')).default;\n}\n\nasync function configure(mods, lists) {\n    const configure = {};\n    for (const mod of mods) {\n        configure[mod] = {};\n    }\n    await Promise\n        .all(lists.map(p=>import(`./config/${p}.js`).catch(_=>null)))\n        .then(modules=>modules.forEach(m => {\n            if(!m) return;\n            for (const mod of mods) {\n                if(!m[mod]) continue;\n                Object.assign(configure[mod], m[mod]());\n            }\n        }));\n    return configure;\n}\n\nasync function initDebug(configure) {\n    if(!configure) return;\n    window.$.debug =\n    window.$debug = configure.on;\n    if($debug && configure.patch) {\n        await configure.patch();\n    }\n}\n\nasync function initLogger(configure) {\n}\n\nasync function initLang(configure) {\n    const {default: Lang} = await import('./i18n/index.js');\n    const lang = new Lang(configure);\n    window.$.lang =\n    window.$lang = lang;\n    await lang.initialize();\n}\n\nasync function initCore(configure) {\n    const {default: Core} = await import('./core/index.js');\n    const core = new Core(configure);\n    window.$.core =\n    window.$$ =\n    window.$core = core;\n    await core.initialize();\n}\n\nasync function initApp(configure) {\n    const {default: App} = await import('./app/index.js');\n    const app = new App(configure);\n    window.$.app =\n    window.$app = app;\n    await app.initialize();\n}\n\nfunction dURL() {\n    const match = /\\/#\\/(([^\\/\\?]+)\\/?)(\\?+(.*))?/\n        .exec(window.location.href);\n    if(!match) return;\n    let [,,page,,data,,query] = match;\n    if(!data) data = {};\n    else data = JSON.parse(decodeURIComponent(data));\n    if(query)\n        query.split('&').forEach(v=>{\n            const [key, value] = v.split('=');\n            data[key] = JSON.parse(decodeURIComponent(value))\n        });\n    $app.switch(page, data);\n}\n\nexport async function start(cfgList) {\n    window.onerror = (msg,source,line,col,error) =>\n        alert(`${msg}at: ${source||\"<anonymous>\"}:${line}:${col}\\n${error}`);\n\n    await initGlobal();\n\n    $on('network.banned', ()=>window.location.reload());\n\n    const { debug, logger, i18n, core, app } = await configure(\n        ['debug', 'logger', 'i18n', 'core', 'app'], cfgList\n    );\n\n    await initDebug(debug);\n    await initLogger(logger);\n    await initLang(i18n);\n    await initCore(core);\n    await initApp(app);\n\n    $app.loading(true);\n    try {\n        const banned = $core.database.kv.get('banned');\n        if(banned && banned > Date.now()) {\n            $app.tips($lang.t.banned);\n            return;\n        }\n        await $core.start();\n        await $app.start();\n        $app.loading(false);\n        $emit('system.start');\n    } catch(e) {\n        console.error(e);\n        $app.tips($lang.t.init_err);\n    }\n    window.onpopstate = dURL;\n    dURL();\n}\n\nexport default start;","import { start } from './system.js';\n\nstart([\n    'configure.default',\n    'configure.search',\n    'configure',\n]);"],"names":["__variableDynamicImportRuntimeHelper","exports","glob","path","v","Promise","resolve","_","reject","queueMicrotask","setTimeout","bind","Error","initGlobal","_initGlobal","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","window","$","__vitePreload","module","import","__VITE_IS_MODERN__","utils","$u","$utils","sent","logic","$logic","normalize","$norml","$normalize","hash","$hash","event","$event","$on","on","$off","off","$emit","emit","moment","$moment","default","stop","this","configure","_x","_x2","_configure","_callee2","mods","lists","_iterator4","_step4","mod","_callee2$","_context2","_createForOfIteratorHelper","s","n","done","value","err","e","f","all","map","p","Object","assign","concat","catch","then","modules","forEach","m","_step5","_iterator5","abrupt","initDebug","_x3","_initDebug","_callee3","_context3","debug","$debug","patch","initLogger","_x4","_initLogger","_callee4","_context4","initLang","_x5","_initLang","_callee5","_yield$__vitePreload","Lang","lang","_callee5$","_context5","$lang","initialize","initCore","_x6","_initCore","_callee6","_yield$__vitePreload2","Core","core","_callee6$","_context6","$$","$core","initApp","_x7","_initApp","_callee7","_yield$__vitePreload3","App","app","_callee7$","_context7","$app","dURL","match","exec","location","href","_match","_slicedToArray","page","data","query","JSON","parse","decodeURIComponent","split","_v$split2","key","switch","_start","_callee8","cfgList","_yield$configure","i18n","banned","_context8","onerror","msg","source","line","col","error","alert","reload","logger","loading","database","kv","get","Date","now","tips","t","start","t0","console","init_err","onpopstate","_x8"],"mappings":"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"}